/*!
 * ImgPreviewer v1.0.0
 * https://github.com/yue1123/img-previewer
 *
 * Copyright 2021-present dh
 * Released under the MIT license
 *
 * Date: 2021-02-28T15:23:36.802Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgPreviewer=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){var n=null;return function(i){clearTimeout(n),n=setTimeout((function(){e(i),clearTimeout(n)}),t)}}function i(e){e.preventDefault()}function o(e,t,n){var i=r*n/e,o=d*n/t;return i>o?o:i}function a(e,t,n,i,o){e.style.cssText="width:".concat(t,"px;height:").concat(n,"px;position:fixed; top:").concat(o,"px; left:").concat(i,"px;")}function s(e){u.style.display=e?"block":"none"}function c(e){l.style.overflow=e?"auto":"hidden"}var l,d,r,u=null,m=null,h=null,f=0,g={ratio:.9,zoom:{min:.1,max:5,step:.1},opacity:.6,scrollbar:!1};return function(){function p(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e(this,p),this.selector=t,this.options=n,this.config=Object.assign({},g,n),this.index=0,this.imageElements=[],!t||"string"!=typeof t)throw new Error("ImagePreviewer plugin should css string selector that on first params,like #el,.el");var i=document.querySelector(t);if(!i)throw new Error("selector is invalid");this.init()}var v,y,x;return v=p,x=[{key:"setImageAnimationParams",value:function(e){m.style.setProperty("--offsetX","".concat(e.endX,"px")),m.style.setProperty("--offsetY","".concat(e.endY+30,"px")),m.style.setProperty("--scale","".concat(e.scale)),m.style.setProperty("--rotate","".concat(e.rotate,"deg"))}}],(y=[{key:"bindEvent",value:function(){var e=this,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent),o=t?"touchstart":"mousedown",a=t?"touchend":"mouseup",c=t?"touchmove":"mousemove";this.imageElements.forEach((function(t,n){t.addEventListener("click",(function(t){e.handleOpen(t,n),s(!0),e.updateIndex(n)}))})),document.getElementById("close").addEventListener("click",(function(){e.handleClose()})),document.getElementById("reset").addEventListener("click",(function(){e.handleReset()})),document.getElementById("prev").addEventListener("click",(function(){e.prev()})),document.getElementById("next").addEventListener("click",(function(){e.next()})),u.addEventListener("click",(function(t){"image-container"===t.target.classList[0]&&e.handleClose()})),m.addEventListener(o,(function(e){var t=e.clientX-m.offsetLeft,n=e.clientY-m.offsetTop;this.classList.add("moving"),this["on".concat(c)]=function(e){var i=e.clientX-t,o=e.clientY-n;this.style.left="".concat(i,"px"),this.style.top="".concat(o,"px")},this["on".concat(a)]=function(){this.classList.remove("moving"),this.onmousemove=null},this.onmouseout=function(){this.classList.remove("moving"),this.onmousemove=null}})),m.addEventListener("mousewheel",(function(t){var n=e.config.zoom,i=n.min,o=n.max,a=n.step;t.wheelDelta>0&&f<o?f+=a:f>i&&(f-=a),m.style.setProperty("--scale","".concat(f.toFixed(2)))}),!0),document.getElementById("rotate-right").addEventListener("click",(function(){e.handelRotateRight()})),document.getElementById("rotate-left").addEventListener("click",(function(){e.handelRotateLeft()})),u.addEventListener("mousewheel",i),document.ondragstart=i,document.ondragend=i,window.onresize=n.bind(null,(function(){e.handleClose(),r=window.innerWidth,d=window.innerHeight}),100)()}},{key:"update",value:function(){}},{key:"handleReset",value:function(){m.style.top="".concat(h.startY,"px"),m.style.left="".concat(h.startX,"px"),m.style.setProperty("--rotate","".concat(0,"deg")),m.style.setProperty("--scale","".concat(h.scale))}},{key:"handleOpen",value:function(e,t){var n=this.config.ratio,i=this.imageElements,s=e.target,l=s.width,g=s.height,v=e.clientX-e.offsetX,y=e.clientY-e.offsetY+1;f=o(l,g,n),h={startX:v,startY:y,endX:r/2-l/2-v,endY:d/2-g/2-y,scale:f,rotate:0},m.src=i[t].src,a(m,l,g,v,y),setTimeout((function(){p.setImageAnimationParams(h)})),u.classList.add("show"),!this.config.scrollbar&&c(!1)}},{key:"handleClose",value:function(){var e,t,n,i,o,a,l,d,r,h=this.config.opacity;e=u,t={start:h,end:0,step:-.02,style:"background",template:"rgba(0, 0, 0, $)"},n=function(){m.style="",m.src="",u.style.background="",u.classList.remove("hiding"),s(!1)},i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame,a=t.start||0,l=t.end||0,d=t.step,r=null,function s(){d>0&&a<l||d<0&&a>l?(a+=d,e.style[t.style]=t.template.replace("$",a),r=i(s)):(n&&n(),o(r))}();var f=function(e){return e.getBoundingClientRect()}(this.imageElements[this.index]),g=f.top,p=f.left,v=f.width,y=f.height;m.style.cssText="width:".concat(v,"px;height:").concat(y,"px;position: fixed; top: ").concat(g,"px; left: ").concat(p,"px;"),u.classList.remove("show"),u.classList.add("hiding"),!this.config.scrollbar&&c(!0)}},{key:"handelRotateLeft",value:function(){h.rotate-=90,m.style.setProperty("--rotate","".concat(h.rotate,"deg"))}},{key:"handelRotateRight",value:function(){h.rotate+=90,m.style.setProperty("--rotate","".concat(h.rotate,"deg"))}},{key:"prev",value:function(){0!==this.index&&(this.index-=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"next",value:function(){this.index<this.imageElements.length-1&&(this.index+=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"useIndexUpdateImage",value:function(e){var t=this.config.ratio,n=this.imageElements[e],i=n.height,s=n.width,c=n.src;m.classList.add("moving"),a(m,s,i,r/2-s/2,d/2-i/2),h={endX:0,endY:0,scale:o(s,i,t),rotate:0},m.src=c,p.setImageAnimationParams(h),setTimeout((function(){m.classList.remove("moving")}))}},{key:"updateIndex",value:function(e){this.index=e,document.getElementById("total-nums").innerText=this.imageElements.length,document.getElementById("current-index").innerText=e+1}},{key:"render",value:function(){var e=document.getElementById("image-preview-container");e?u=e:((u=document.createElement("div")).classList.add("image-preview-container"),u.id="image-preview-container",u.innerHTML='<div class="preview-header">\n                        <div class="nums">\n                            <button id="prev" data-tooltip="上一张"><i class="iconfont icon-shangyige"></i></button>\n                            <p>\n                                <span id="current-index"></span>\n                                /\n                                <span id="total-nums"></span>\n                            </p>\n                            <button id="next" data-tooltip="下一张"><i class="iconfont icon-xiayige"></i></button>\n                        </div>\n                        <div class="tool-btn">\n                            <button id="rotate-left" data-tooltip="向右旋转"><i class="iconfont icon-xuanzhuan"></i></button>\n                            <button id="rotate-right" data-tooltip="向左旋转"><i class="iconfont icon-xuanzhuan1"></i></button>\n                            <button id="reset" data-tooltip="重置"><i class="iconfont icon-zhongzhi"></i></button>\n                            <button id="close" data-tooltip="关闭"><i class="iconfont icon-account-practice-lesson-close"></i></button>\n                        </div>\n                    </div>\n                    <div class="image-container">\n                        <div class="img-content" id="image-content"><img id="preview-image" src="" alt="" /></div>\n                    </div>',l.appendChild(u)),m=document.getElementById("preview-image")}},{key:"init",value:function(){l=document&&document.body||document.getElementsByTagName("body")[0],r=window.innerWidth,d=window.innerHeight,this.imageElements=document.querySelectorAll("".concat(this.selector," img"));for(var e=0,t=this.imageElements.length;e<t;e++)this.imageElements[e].classList.add("zoom-in");this.render(),this.updateIndex(this.index),this.bindEvent(this.imageElements)}}])&&t(v.prototype,y),x&&t(v,x),p}()}));
